Description: Master stack
Parameters:
  CertificateArn:
    Type: String
  DomainName:
    Default: hyperboa.com
    Type: String
  Environment:
    Default: ''
    Type: String
  GithubOAuthToken:
    Description: Github access token
    Type: String
  GithubOwner:
    Default: ADBurpitt
    Description: Github repo owner
    Type: String
  GithubRepo:
    Default: idek-rn-bro
    Description: Github repo name
    Type: String
  ProjectSource:
    Default: https://github.com/adburpitt/idek-rn-bro
    Description: Source URL
    Type: String
Resources:
  Infrastructure:
    Properties:
      Parameters:
        CertificateArn:
          Ref: CertificateArn
        DomainName:
          Ref: DomainName
        Environment:
          Ref: Environment
      TemplateURL: https://s3.amazonaws.com/frankfurt-templates/9746a165fbb3f4f66f68687057845d05.template
    Type: AWS::CloudFormation::Stack
  Pipeline:
    DependsOn: Infrastructure
    Properties:
      Parameters:
        ApiBuild:
          Fn::GetAtt:
          - Infrastructure
          - Outputs.ApiBuild
        CertificateArn:
          Ref: CertificateArn
        DomainName:
          Ref: DomainName
        Environment:
          Ref: Environment
        FrontendBuild:
          Fn::GetAtt:
          - Infrastructure
          - Outputs.FrontendBuild
        GithubOAuthToken:
          Ref: GithubOAuthToken
        GithubOwner:
          Ref: GithubOwner
        GithubRepo:
          Ref: GithubRepo
        ProjectSource:
          Ref: ProjectSource
        StackName:
          Fn::GetAtt:
          - Infrastructure
          - Outputs.StackName
      TemplateURL: https://s3.amazonaws.com/frankfurt-templates/a18b7fe67370d45cd0c93dfad489eadc.template
    Type: AWS::CloudFormation::Stack
